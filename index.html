<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alarme Android Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: #000; color: white; }
        .btn-grad { background-image: linear-gradient(to right, #314755 0%, #26a0da 51%, #314755 100%); transition: 0.5s; background-size: 200% auto; }
        .btn-grad:hover { background-position: right center; }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-6 text-center">

    <!-- Tela Principal -->
    <div id="mainScreen" class="w-full max-w-sm flex flex-col items-center gap-8">
        <div>
            <h1 class="text-3xl font-bold text-blue-500 mb-2">Alarme Vocal</h1>
            <p class="text-gray-400">Toque e diga o horário</p>
        </div>

        <div class="relative">
            <button id="micBtn" onclick="toggleMic()" class="w-32 h-32 rounded-full bg-gray-800 border-4 border-gray-700 flex items-center justify-center active:scale-95 transition-all shadow-[0_0_30px_rgba(59,130,246,0.2)]">
                <i id="micIcon" class="fas fa-microphone text-4xl text-blue-500"></i>
            </button>
            <div id="ripple" class="absolute inset-0 rounded-full border-2 border-blue-500 opacity-0 pointer-events-none"></div>
        </div>

        <p id="status" class="h-6 text-blue-300 font-medium">Toque para iniciar</p>
    </div>

    <!-- Tela de Confirmação (Link Real) -->
    <div id="confirmScreen" class="hidden w-full max-w-sm bg-gray-900 border border-gray-800 p-8 rounded-3xl shadow-2xl">
        <h2 class="text-gray-400 text-sm uppercase tracking-wider mb-4">Confirmar Horário</h2>
        
        <div class="text-6xl font-bold text-white mb-8 font-mono tracking-tighter" id="timeDisplay">
            00:00
        </div>

        <!-- O SEGREDO ESTÁ AQUI: Um link <a> real, não apenas Javascript -->
        <a id="realLink" href="#" class="btn-grad w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg block mb-4">
            ABRIR RELÓGIO
        </a>

        <button onclick="resetApp()" class="text-gray-500 text-sm hover:text-white underline">
            Cancelar / Tentar de novo
        </button>
    </div>

    <script>
        // Elementos
        const micBtn = document.getElementById('micBtn');
        const status = document.getElementById('status');
        const mainScreen = document.getElementById('mainScreen');
        const confirmScreen = document.getElementById('confirmScreen');
        const timeDisplay = document.getElementById('timeDisplay');
        const realLink = document.getElementById('realLink');
        const ripple = document.getElementById('ripple');

        let recognition = null;

        // Configurar Reconhecimento
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;
            
            recognition.onstart = () => {
                status.innerText = "Ouvindo...";
                micBtn.classList.replace('border-gray-700', 'border-red-500');
                document.getElementById('micIcon').classList.replace('text-blue-500', 'text-red-500');
                ripple.classList.add('animate-ping', 'opacity-75');
            };

            recognition.onend = () => {
                micBtn.classList.replace('border-red-500', 'border-gray-700');
                document.getElementById('micIcon').classList.replace('text-red-500', 'text-blue-500');
                ripple.classList.remove('animate-ping', 'opacity-75');
                if (mainScreen.style.display !== 'none') status.innerText = "Toque para falar";
            };

            recognition.onresult = (e) => processVoice(e.results[0][0].transcript);
        } else {
            status.innerText = "Navegador sem suporte a voz.";
        }

        function toggleMic() {
            if (recognition) recognition.start();
        }

        function processVoice(text) {
            console.log("Falou: " + text);
            text = text.toLowerCase().replace(':', ' ');
            
            let h = null, m = 0;

            // Lógica de Parsing
            if (text.includes('meio dia')) h = 12;
            else if (text.includes('meia noite')) h = 0;
            
            const nums = text.match(/\d+/g);
            if (nums) {
                h = parseInt(nums[0]);
                if (nums[1]) m = parseInt(nums[1]);
            } else {
                // Fallback básico extenso
                const map = {'uma':1,'um':1,'duas':2,'dois':2,'três':3,'quatro':4,'cinco':5,'seis':6,'sete':7,'oito':8,'nove':9,'dez':10,'onze':11,'doze':12,'vinte':20};
                for(let w of text.split(' ')) if(map[w]) { h = map[w]; break; }
                if(text.includes('meia') && h!==null) m = 30;
            }

            if (h !== null && h >= 0 && h <= 24) {
                showConfirm(h, m);
            } else {
                status.innerText = "Não entendi. Tente '07:30' ou 'Oito horas'.";
            }
        }

        function showConfirm(h, m) {
            // Formatar visual
            timeDisplay.innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
            
            // Construir o link Intent EXATO
            // Action: android.intent.action.SET_ALARM
            // Extras: HOUR (int), MINUTES (int), MESSAGE (string)
            // IMPORTANTE: Sem SKIP_UI para forçar abertura
            
            const intent = `intent:#Intent;action=android.intent.action.SET_ALARM;i.android.intent.extra.alarm.HOUR=${h};i.android.intent.extra.alarm.MINUTES=${m};S.android.intent.extra.alarm.MESSAGE=Alarme%20Web;end`;
            
            // Definir o href do botão
            realLink.href = intent;

            // Trocar telas
            mainScreen.classList.add('hidden');
            confirmScreen.classList.remove('hidden');
            confirmScreen.classList.add('flex', 'flex-col', 'items-center');
        }

        function resetApp() {
            confirmScreen.classList.add('hidden');
            confirmScreen.classList.remove('flex');
            mainScreen.classList.remove('hidden');
            status.innerText = "Toque para falar";
        }
    </script>
</body>
</html>


